# Step 0: Agent Engine ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆã¨è¨­å®š

## ğŸ“‹ ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚„ã‚‹ã“ã¨

```mermaid
flowchart LR
    A["1. Client åˆæœŸåŒ–"] --> B["2. Agent Engine\nã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ"]
    B --> C["3. Embedding ãƒ¢ãƒ‡ãƒ«ã‚’\nmultilingual ã«å¤‰æ›´"]
```

---

## ğŸ’¡ Insight 1: Agent Engine = AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æœ¬ç•ªé‹ç”¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

**Vertex AI Agent Engine** ã¯ã€ŒMemory Bank ã®å…¥ã‚Œç‰©ã€ã§ã¯ãªãã€AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ç®¡ç†ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®**ã‚µãƒ¼ãƒ“ã‚¹ç¾¤**ã€‚Memory Bank ã¯ãã®ä¸­ã®ä¸€æ©Ÿèƒ½ã«ã™ããªã„ã€‚

| ã‚µãƒ¼ãƒ“ã‚¹ | èª¬æ˜ |
|---------|------|
| **Runtime** | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ã‚¹ã‚±ãƒ¼ãƒ« |
| **Sessions** | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®ã‚„ã‚Šã¨ã‚Šã‚’ä¿å­˜ |
| **Memory Bank** | ã‚»ãƒƒã‚·ãƒ§ãƒ³ / ä¼šè©±ã‹ã‚‰æƒ…å ±ã‚’ä¿å­˜ãƒ»å–å¾—ã—ã¦å¯¾è©±ã‚’ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚º |
| **Code Execution** (Preview) | ã‚»ã‚­ãƒ¥ã‚¢ãªã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã§ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ |
| **Example Store** (Preview) | Few-shot examples ã®ä¿å­˜ã¨å‹•çš„å–å¾— |

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãªãã¦ã‚‚ Memory Bank **å˜ä½“** ã§ä½¿ãˆã‚‹ã€‚
1ã¤ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»è¤‡æ•°ã‚¹ã‚³ãƒ¼ãƒ—ã®ãƒ¡ãƒ¢ãƒªã‚’ç®¡ç†ã§ãã‚‹ã€‚

```
Agent Engine ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ç¾¤ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆï¼‰
â”œâ”€â”€ [Sessions] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”œâ”€â”€ [Memory Bank] ãƒ¡ãƒ¢ãƒªç®¡ç†
â”‚   â”œâ”€â”€ user-1 ã®ãƒ¡ãƒ¢ãƒªç¾¤
â”‚   â”œâ”€â”€ user-2 ã®ãƒ¡ãƒ¢ãƒªç¾¤
â”‚   â””â”€â”€ ...
â”œâ”€â”€ [Code Execution] ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹
â””â”€â”€ [Example Store] Few-shot examples
```

---

## ğŸ’¡ Insight 2: Embedding ãƒ¢ãƒ‡ãƒ«ã®é¸ã³æ–¹

Memory Bank ã¯å†…éƒ¨ã§ãƒ†ã‚­ã‚¹ãƒˆã® **ãƒ™ã‚¯ãƒˆãƒ«è¡¨ç¾ (embedding)** ã‚’ä½¿ã£ã¦é¡ä¼¼æ¤œç´¢ã‚’è¡Œã†ã€‚

| ã‚¿ã‚¤ãƒŸãƒ³ã‚° | ä½•ã‚’ãƒ™ã‚¯ãƒˆãƒ«åŒ–ï¼Ÿ |
|-----------|---------------|
| **ãƒ¡ãƒ¢ãƒªä½œæˆæ™‚** | ä¿å­˜ã™ã‚‹ fact ã®ãƒ†ã‚­ã‚¹ãƒˆ |
| **æ¤œç´¢æ™‚** | `search_query` ã®ãƒ†ã‚­ã‚¹ãƒˆ |

ä¸¡æ–¹ãŒ**åŒã˜ãƒ¢ãƒ‡ãƒ«**ã§ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã•ã‚Œãªã„ã¨ã€æ­£ã—ã„é¡ä¼¼åº¦ãŒè¨ˆç®—ã§ããªã„ã€‚

### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ«ã®å•é¡Œ

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `text-embedding-005`ï¼ˆè‹±èªæœ€é©åŒ–ï¼‰ã€‚æ—¥æœ¬èªã§ã¯æ„å‘³çš„ãªæ¤œç´¢ç²¾åº¦ãŒè½ã¡ã‚‹ã€‚

```
ã‚¯ã‚¨ãƒª: ã€Œã©ã‚“ãªé–‹ç™ºã‚’ã—ã¦ã„ã¾ã™ã‹ï¼Ÿã€
æœŸå¾…: ã€Œã‚³ãƒ¼ãƒãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é–‹ç™ºä¸­ã€ â† ã“ã‚ŒãŒãƒ’ãƒƒãƒˆã—ã¦ã»ã—ã„
å®Ÿéš›: ã€Œè¶£å‘³ã¯çµµã‚’æãã“ã¨ã€           â† é•ã†ãƒ¡ãƒ¢ãƒªãŒãƒ’ãƒƒãƒˆ ğŸ˜¢
```

### è§£æ±ºç­–: multilingual ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›´

```python
EMBEDDING_MODEL = (
    f"projects/{PROJECT_ID}/locations/{LOCATION}"
    f"/publishers/google/models/text-multilingual-embedding-002"
)
```

> **âš ï¸ æ³¨æ„**: ãƒ¢ãƒ‡ãƒ«åã¯çŸ­ç¸®åï¼ˆ`text-multilingual-embedding-002`ï¼‰ã§ã¯ãªãã€
> ãƒ•ãƒ«ãƒªã‚½ãƒ¼ã‚¹ãƒ‘ã‚¹å½¢å¼ã§æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

---

## ğŸ’¡ Insight 3: update() ã® config æ§‹é€ 

Agent Engine ã®è¨­å®šå¤‰æ›´ã¯ `update()` ã§è¡Œã†ã€‚Memory Bank é–¢é€£ã®è¨­å®šã¯ `config.context_spec.memory_bank_config` ã«å…¥ã‚‹ã€‚

```python
client.agent_engines.update(
    name=AGENT_ENGINE_NAME,
    config={
        "context_spec": {                          # â† AgentEngineConfig ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
            "memory_bank_config": {                # â† ReasoningEngineContextSpec ã®ä¸­
                "similarity_search_config": {
                    "embedding_model": "projects/..."
                }
            }
        }
    },
)
```

è¨­å®šã§ãã‚‹é …ç›®ã¯ä»–ã«ã‚‚ã‚ã‚‹:

| config ãƒ‘ã‚¹ | èª¬æ˜ |
|------------|------|
| `memory_bank_config.similarity_search_config` | embedding ãƒ¢ãƒ‡ãƒ« |
| `memory_bank_config.generation_config` | ãƒ¡ãƒ¢ãƒªç”Ÿæˆã«ä½¿ã† LLM ãƒ¢ãƒ‡ãƒ« |
| `memory_bank_config.customization_configs` | ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ”ãƒƒã‚¯ãƒ»ç”Ÿæˆä¾‹ |
| `memory_bank_config.ttl_config` | ãƒ¡ãƒ¢ãƒªã®æœ‰åŠ¹æœŸé™ï¼ˆTTLï¼‰ |
| `memory_bank_config.disable_memory_revisions` | ãƒªãƒ“ã‚¸ãƒ§ãƒ³è¨˜éŒ²ã®ç„¡åŠ¹åŒ– |

---

## âœ… ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] Agent Engine ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã•ã‚ŒãŸã‹
- [ ] `.env` ã« `AGENT_ENGINE_NAME` ã‚’è¿½è¨˜ã—ãŸã‹
- [ ] embedding ãƒ¢ãƒ‡ãƒ«ãŒ `text-multilingual-embedding-002` ã«è¨­å®šã•ã‚ŒãŸã‹
